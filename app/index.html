<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PARACEL ¬∑ Sondeo Sem√°foro</title>
  <meta name="description" content="Sistema de monitoreo de clima social y alerta temprana">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./icons/icon-192.png">
  <meta name="theme-color" content="#064e3b">
  <link rel="stylesheet" href="./styles.css">
</head>

<body>

  <!-- ================================
     LOGIN SCREEN
     ================================ -->
  <div id="cardLogin" class="login-bg">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="glass glass-login">
      <div class="login-logo">
        <!-- Shield icon -->
        <svg viewBox="0 0 24 24">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
        </svg>
      </div>
      <div class="login-title">PARACEL</div>
      <div class="login-subtitle">Sondeo Sem√°foro</div>
      <p class="muted" style="text-align:center;margin-top:4px;font-size:11px;">Sistema de Monitoreo de Clima Social</p>

      <div style="margin-top:24px;display:flex;flex-direction:column;gap:14px;">
        <div>
          <label>
            <svg viewBox="0 0 24 24">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Usuario
          </label>
          <input type="text" id="loginUser" placeholder="Ingrese su usuario">
        </div>
        <div>
          <label>
            <svg viewBox="0 0 24 24">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
            </svg>
            Contrase√±a
          </label>
          <input type="password" id="loginPass" placeholder="Ingrese su contrase√±a">
        </div>
        <button class="btn btn-primary btn-lg" id="btnLogin" style="width:100%;margin-top:4px;">
          <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
            <polyline points="10 17 15 12 10 7" />
            <line x1="15" y1="12" x2="3" y2="12" />
          </svg>
          Ingresar
        </button>
        <button class="btn btn-ghost" id="btnClear" style="width:100%;">Limpiar</button>
      </div>
      <div id="loginMsg"></div>
      <div class="login-footer">
        Modo offline: la encuesta se guarda en el tel√©fono y se sincroniza al volver la conexi√≥n.
        <br>¬© 2025 PARACEL ‚Äì Sistema de Alerta Temprana
      </div>
    </div>
  </div>

  <!-- ================================
     MAIN APP
     ================================ -->
  <div id="cardApp" style="display:none;">
    <div class="app-bg">
      <!-- Frosted Header -->
      <header class="topbar">
        <div class="logo-box">
          <svg viewBox="0 0 24 24">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
        </div>
        <div>
          <div class="title-text" id="appTitle">PARACEL</div>
          <div class="subtitle-text">Sondeo Sem√°foro</div>
        </div>
        <div class="right">
          <div class="badge badge-active">
            <span class="dot"></span> Sistema Activo
          </div>
          <span class="badge" id="netPill">Online</span>
          <button class="btn btn-ghost" id="btnLogout" style="display:none;">
            <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Cerrar sesi√≥n
          </button>
        </div>
      </header>

      <div class="wrap">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" id="tabForm">
            <svg viewBox="0 0 24 24">
              <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2" />
              <rect x="9" y="3" width="6" height="4" rx="1" />
              <path d="M9 14l2 2 4-4" />
            </svg>
            Cuestionario
          </button>
          <button class="tab" id="tabDash" style="display:none;">
            <svg viewBox="0 0 24 24">
              <rect x="3" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="14" width="7" height="7" rx="1" />
              <rect x="3" y="14" width="7" height="7" rx="1" />
            </svg>
            Tablero
          </button>
        </div>

        <!-- ================================
           SURVEY FORM
           ================================ -->
        <div id="panelForm">
          <!-- Instructions -->
          <div class="instructions-box">
            <h3>üìã Instrucciones r√°pidas para la persona encuestadora</h3>
            <ul>
              <li>Complete cada secci√≥n en orden.</li>
              <li>Los campos con <span class="tag-red">Obligatorio</span> deben completarse.</li>
              <li>Si no hay se√±ales de alerta, marque <b>"G ‚Äì Ninguno"</b> y contin√∫e.</li>
              <li>El <b>sem√°foro</b> se calcula autom√°ticamente al enviar.</li>
              <li>Sin conexi√≥n, la encuesta se guarda y sincroniza despu√©s.</li>
            </ul>
          </div>

          <!-- ========== SECCI√ìN 0: Identificaci√≥n ========== -->
          <div class="section-card glass">
            <div class="section-hdr hdr-emerald">
              <svg viewBox="0 0 24 24">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="16" y1="13" x2="8" y2="13" />
                <line x1="16" y1="17" x2="8" y2="17" />
              </svg>
              SECCI√ìN 0 ¬∑ Identificaci√≥n m√≠nima
            </div>
            <div class="section-body">
              <div class="grid3">
                <div>
                  <label>
                    <svg viewBox="0 0 24 24">
                      <rect x="3" y="4" width="18" height="18" rx="2" />
                      <line x1="16" y1="2" x2="16" y2="6" />
                      <line x1="8" y1="2" x2="8" y2="6" />
                      <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    P01: Fecha y hora
                  </label>
                  <input type="datetime-local" id="P01" readonly style="background:var(--emerald-50);">
                </div>
                <div>
                  <label>
                    <svg viewBox="0 0 24 24">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                      <circle cx="12" cy="7" r="4" />
                    </svg>
                    P02: Tipo de informante <span class="qreq">Obligatorio</span>
                  </label>
                  <select id="P02" style="background:var(--emerald-50);">
                    <option value="">Seleccionar‚Ä¶</option>
                    <option>Miembro comunitario</option>
                    <option>Miembro de instituci√≥n educativa</option>
                    <option>Miembro del equipo de Paracel</option>
                    <option>Persona del √°rea salud</option>
                    <option>Comerciante</option>
                    <option>L√≠der/lideresa local</option>
                    <option>Empresa contratista</option>
                    <option>Autoridad municipal o departamental</option>
                    <option>Miembro de la funci√≥n p√∫blica</option>
                    <option>Miembro de la Polic√≠a Nacional</option>
                    <option>Productor/a local</option>
                    <option>Organizaci√≥n comunitaria o social</option>
                    <option>Referente religioso</option>
                    <option>ONG</option>
                    <option value="Otro">Otro</option>
                  </select>
                  <div id="P02OtroWrap" class="hidden" style="margin-top:8px;">
                    <input type="text" id="P02Otro" placeholder="Especifique tipo de informante">
                  </div>
                </div>
              </div>

              <div class="grid3" style="margin-top:10px;">
                <div>
                  <label>
                    <svg viewBox="0 0 24 24">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                      <circle cx="12" cy="10" r="3" />
                    </svg>
                    Departamento <span class="qreq">Obligatorio</span>
                  </label>
                  <select id="P03Depto" style="background:var(--emerald-50);">
                    <option value="">Seleccionar‚Ä¶</option>
                    <option>Concepci√≥n</option>
                    <option>San Pedro</option>
                    <option>Cordillera</option>
                    <option>Guair√°</option>
                    <option>Caaguaz√∫</option>
                    <option>Caazap√°</option>
                    <option>Itap√∫a</option>
                    <option>Misiones</option>
                    <option>Paraguar√≠</option>
                    <option>Alto Paran√°</option>
                    <option>Central</option>
                    <option>√ëeembuc√∫</option>
                    <option>Amambay</option>
                    <option>Canindey√∫</option>
                    <option>Pdte. Hayes</option>
                    <option>Boquer√≥n</option>
                    <option>Alto Paraguay</option>
                    <option>Asunci√≥n</option>
                  </select>
                </div>
                <div>
                  <label>Distrito</label>
                  <input type="text" id="P03Distrito" placeholder="Distrito" style="background:var(--emerald-50);">
                </div>
                <div>
                  <label>Comunidad o Barrio</label>
                  <input type="text" id="P03Comunidad" placeholder="Comunidad o Barrio"
                    style="background:var(--emerald-50);">
                </div>
              </div>

              <div class="qcard" style="margin-top:14px;">
                <div class="qhead">
                  <span class="qdim">Identificaci√≥n</span>
                  <span class="qreq">Obligatorio</span>
                </div>
                <div class="qtext">P04: ¬øEn qu√© tipo de lugar se capta este sondeo?</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="P04" value="Comunidad ind√≠gena"><span
                      class="indicator"></span><span>Comunidad ind√≠gena</span></label>
                  <label class="opt-label"><input type="radio" name="P04" value="Rural no ind√≠gena"><span
                      class="indicator"></span><span>Rural no ind√≠gena</span></label>
                  <label class="opt-label"><input type="radio" name="P04" value="Urbano"><span
                      class="indicator"></span><span>Urbano</span></label>
                  <label class="opt-label"><input type="radio" name="P04" value="Alojamientos"><span
                      class="indicator"></span><span>Alojamientos</span></label>
                  <label class="opt-label"><input type="radio" name="P04" value="√Åreas operacionales"><span
                      class="indicator"></span><span>√Åreas operacionales</span></label>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== SECCI√ìN 1: Estado general ========== -->
          <div class="section-card glass">
            <div class="section-hdr hdr-blue">
              <svg viewBox="0 0 24 24">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
              </svg>
              SECCI√ìN 1 ¬∑ Estado general
            </div>
            <div class="section-body">
              <div class="qcard">
                <div class="qhead"><span class="qdim">Estado general</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P05: ¬øC√≥mo est√° el ambiente social hoy en la zona?</div>
                <div class="muted">(1 = Muy tranquilo ¬∑ 5 = Muy tenso)</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="P05" value="1"><span
                      class="indicator"></span><span>1 ‚Äì Muy tranquilo</span></label>
                  <label class="opt-label"><input type="radio" name="P05" value="2"><span
                      class="indicator"></span><span>2 ‚Äì Tranquilo</span></label>
                  <label class="opt-label"><input type="radio" name="P05" value="3"><span
                      class="indicator"></span><span>3 ‚Äì Regular</span></label>
                  <label class="opt-label"><input type="radio" name="P05" value="4"><span
                      class="indicator"></span><span>4 ‚Äì Tenso</span></label>
                  <label class="opt-label"><input type="radio" name="P05" value="5"><span
                      class="indicator"></span><span>5 ‚Äì Muy tenso</span></label>
                </div>
              </div>

              <div class="qcard">
                <div class="qhead"><span class="qdim">Tendencia</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P06: Comparado con el √∫ltimo mes, ¬øel ambiente social‚Ä¶?</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="P06" value="Mejor√≥"><span
                      class="indicator"></span><span>Mejor√≥</span></label>
                  <label class="opt-label"><input type="radio" name="P06" value="Sigue igual"><span
                      class="indicator"></span><span>Sigue igual</span></label>
                  <label class="opt-label"><input type="radio" name="P06" value="Empeor√≥"><span
                      class="indicator"></span><span>Empeor√≥</span></label>
                </div>
              </div>

              <div class="qcard">
                <div class="qhead"><span class="qdim">Certeza</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P07: ¬øQu√© tanta certeza tiene de esta informaci√≥n?</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="P07" value="Alta"><span
                      class="indicator"></span><span>Alta</span></label>
                  <label class="opt-label"><input type="radio" name="P07" value="Media"><span
                      class="indicator"></span><span>Media</span></label>
                  <label class="opt-label"><input type="radio" name="P07" value="Baja"><span
                      class="indicator"></span><span>Baja</span></label>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== SECCI√ìN 2: Se√±ales de alerta ========== -->
          <div class="section-card glass">
            <div class="section-hdr hdr-amber">
              <svg viewBox="0 0 24 24">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                <line x1="12" y1="9" x2="12" y2="13" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
              </svg>
              SECCI√ìN 2 ¬∑ Se√±ales de alerta temprana
            </div>
            <div class="section-body">
              <div class="qcard">
                <div class="qhead"><span class="qdim">Alertas</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P08: ¬øPas√≥ algo de esto en la zona? (Marcar todos los que aplican)</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="checkbox" data-p08 value="A"><span
                      class="indicator"></span><span>A ‚Äì Amenazas o advertencias</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="B"><span
                      class="indicator"></span><span>B ‚Äì Reuni√≥n con tono fuerte</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="C"><span
                      class="indicator"></span><span>C ‚Äì Corte de ruta o anuncio de corte</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="D"><span
                      class="indicator"></span><span>D ‚Äì Protesta, manifestaci√≥n o movilizaci√≥n</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="E"><span
                      class="indicator"></span><span>E ‚Äì Nota formal, petitorio o denuncia</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="F"><span
                      class="indicator"></span><span>F ‚Äì Quejas vinculadas a gesti√≥n de empresas
                      contratistas</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="F2"><span
                      class="indicator"></span><span>Quejas vinculadas a gesti√≥n de empresas fomentadas</span></label>
                  <label class="opt-label"><input type="checkbox" data-p08 value="G" id="P08G"><span
                      class="indicator"></span><span>G ‚Äì Ninguno</span></label>
                </div>
                <div style="margin-top:10px;">
                  <label>¬øOtro? Especifique:</label>
                  <input type="text" id="P08Otro" placeholder="Otra se√±al de alerta‚Ä¶">
                </div>
              </div>

              <!-- P09 ‚Äì Conditional -->
              <div id="wrapP09" class="hidden">
                <div class="qcard">
                  <div class="qhead"><span class="qdim">Probabilidad</span><span class="qreq">Obligatorio</span></div>
                  <div class="qtext">P09: ¬øQu√© tan probable es que se repita esa se√±al de alerta?</div>
                  <div class="opts-grid">
                    <label class="opt-label"><input type="radio" name="P09" value="Baja"><span
                        class="indicator"></span><span>Baja</span></label>
                    <label class="opt-label"><input type="radio" name="P09" value="Media"><span
                        class="indicator"></span><span>Media</span></label>
                    <label class="opt-label"><input type="radio" name="P09" value="Alta"><span
                        class="indicator"></span><span>Alta</span></label>
                  </div>
                </div>
              </div>

              <!-- P10 ‚Äì Conditional -->
              <div id="wrapP10" class="hidden">
                <div class="qcard">
                  <div class="qhead"><span class="qdim">Intervenci√≥n</span><span class="qreq">Obligatorio</span></div>
                  <div class="qtext">P10: ¬øQu√© nivel de intervenci√≥n necesita esto?</div>
                  <div class="p10-cards">
                    <label class="p10-card opt-card-green">
                      <input type="radio" name="P10" value="Verde">
                      <span class="p10-emoji">üü¢</span>
                      <span class="p10-label">Verde</span>
                      <span class="p10-desc">No urgente, seguir monitoreando</span>
                    </label>
                    <label class="p10-card opt-card-yellow">
                      <input type="radio" name="P10" value="Amarillo">
                      <span class="p10-emoji">üü°</span>
                      <span class="p10-label">Amarillo</span>
                      <span class="p10-desc">Actuar esta semana</span>
                    </label>
                    <label class="p10-card opt-card-red">
                      <input type="radio" name="P10" value="Rojo">
                      <span class="p10-emoji">üî¥</span>
                      <span class="p10-label">Rojo</span>
                      <span class="p10-desc">Urgente ‚Äì hoy o ma√±ana</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== SECCI√ìN 3: Tema principal ========== -->
          <div class="section-card glass">
            <div class="section-hdr hdr-purple">
              <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" />
                <line x1="22" y1="12" x2="18" y2="12" />
                <line x1="6" y1="12" x2="2" y2="12" />
                <line x1="12" y1="6" x2="12" y2="2" />
                <line x1="12" y1="22" x2="12" y2="18" />
              </svg>
              SECCI√ìN 3 ¬∑ Tema principal del malestar
            </div>
            <div class="section-body">
              <div class="qcard">
                <div class="qhead"><span class="qdim">Tema</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P11: ¬øCu√°l es el tema principal de la situaci√≥n?</div>
                <select id="P11" style="background:rgba(147,51,234,.04);">
                  <option value="">Seleccionar‚Ä¶</option>
                  <option>Trabajo local</option>
                  <option>Empresas contratistas</option>
                  <option>Camino y tr√°nsito</option>
                  <option>Ambiente</option>
                  <option>Tierra y l√≠mites</option>
                  <option>Compras locales y econom√≠a</option>
                  <option>Relaci√≥n y comunicaci√≥n</option>
                  <option>Impacto ambiental</option>
                  <option>Impacto qu√≠micos</option>
                  <option value="Otro">Otro</option>
                </select>
                <div id="P11OtroWrap" class="hidden" style="margin-top:8px;">
                  <input type="text" id="P11Otro" placeholder="Especifique el tema‚Ä¶">
                </div>
              </div>

              <div class="qcard">
                <div class="qhead"><span class="qdim">Origen</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">¬øLa situaci√≥n viene de rumores o de vivencia directa?</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="tema_origen" value="Rumores"><span
                      class="indicator"></span><span>Rumores (o√≠ que‚Ä¶)</span></label>
                  <label class="opt-label"><input type="radio" name="tema_origen" value="Vivencia propia"><span
                      class="indicator"></span><span>Vivencia propia (yo vi/me pas√≥)</span></label>
                </div>
              </div>

              <!-- P14 ‚Äì Conditional (Rumores) -->
              <div id="wrapP14" class="hidden">
                <div class="qcard">
                  <div class="qhead"><span class="qdim">Canal</span><span class="qtag-opt">Opcional</span></div>
                  <div class="qtext">P14: ¬øPor qu√© canal circul√≥ el rumor? (marque todos)</div>
                  <div class="opts-grid">
                    <label class="opt-label"><input type="checkbox" data-p14 value="WhatsApp"><span
                        class="indicator"></span><span>WhatsApp</span></label>
                    <label class="opt-label"><input type="checkbox" data-p14 value="Facebook"><span
                        class="indicator"></span><span>Facebook</span></label>
                    <label class="opt-label"><input type="checkbox" data-p14 value="Radio local"><span
                        class="indicator"></span><span>Radio local</span></label>
                    <label class="opt-label"><input type="checkbox" data-p14 value="Boca a boca"><span
                        class="indicator"></span><span>Boca a boca</span></label>
                    <label class="opt-label"><input type="checkbox" data-p14 value="Reuni√≥n comunitaria"><span
                        class="indicator"></span><span>Reuni√≥n comunitaria</span></label>
                    <label class="opt-label"><input type="checkbox" data-p14 value="Otro"><span
                        class="indicator"></span><span>Otro</span></label>
                  </div>
                  <div id="P14OtroWrap" class="hidden" style="margin-top:8px;">
                    <input type="text" id="P14Otro" placeholder="Especifique canal‚Ä¶">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== SECCI√ìN 5: Acci√≥n sugerida ========== -->
          <div class="section-card glass">
            <div class="section-hdr hdr-emerald">
              <svg viewBox="0 0 24 24">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
              </svg>
              SECCI√ìN 5 ¬∑ Acci√≥n sugerida
            </div>
            <div class="section-body">
              <div class="qcard">
                <div class="qhead"><span class="qdim">Acci√≥n</span><span class="qreq">Obligatorio</span></div>
                <div class="qtext">P18: ¬øQu√© acci√≥n recomendar√≠a para esta situaci√≥n?</div>
                <div class="opts-grid">
                  <label class="opt-label"><input type="radio" name="P18" value="Mensaje aclaratorio"><span
                      class="indicator"></span><span>Mensaje aclaratorio</span></label>
                  <label class="opt-label"><input type="radio" name="P18"
                      value="Reuni√≥n con l√≠deres o comisi√≥n vecinal"><span class="indicator"></span><span>Reuni√≥n con
                      l√≠deres o comisi√≥n vecinal</span></label>
                  <label class="opt-label"><input type="radio" name="P18" value="Visita t√©cnica"><span
                      class="indicator"></span><span>Visita t√©cnica</span></label>
                  <label class="opt-label"><input type="radio" name="P18" value="Revisi√≥n y control a contratista"><span
                      class="indicator"></span><span>Revisi√≥n y control a contratista</span></label>
                  <label class="opt-label"><input type="radio" name="P18" value="Mesa con autoridades"><span
                      class="indicator"></span><span>Mesa con autoridades</span></label>
                  <label class="opt-label"><input type="radio" name="P18" value="Otro"><span
                      class="indicator"></span><span>Otro</span></label>
                </div>
                <div id="P18OtroWrap" class="hidden" style="margin-top:8px;">
                  <input type="text" id="P18Otro" placeholder="Especifique la acci√≥n‚Ä¶">
                </div>
              </div>

              <div class="qcard">
                <div class="qhead"><span class="qdim">Contacto</span><span class="qtag-opt">Opcional</span></div>
                <div class="qtext">P19: ¬øHay alg√∫n contacto local clave para dar seguimiento?</div>
                <input type="text" id="P19" placeholder="Nombre, cargo, tel√©fono‚Ä¶">
              </div>

              <div class="qcard">
                <div class="qhead"><span class="qdim">Adjuntos</span><span class="qtag-opt">Opcional</span></div>
                <div class="qtext">P20: Adjuntar foto como evidencia y capturar GPS</div>
                <label style="margin:6px 0;">Foto:</label>
                <input type="file" id="P20Foto" accept="image/*" capture="environment" class="file-input">
                <button type="button" class="btn btn-secondary gps-btn" id="btnGPS">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                    <circle cx="12" cy="10" r="3" />
                  </svg>
                  Capturar ubicaci√≥n GPS
                </button>
                <div id="gpsResult" class="muted" style="margin-top:6px;"></div>
              </div>

              <label style="margin-top:14px;">Comentario general (opcional)</label>
              <textarea id="metaComentario" placeholder="Observaciones adicionales‚Ä¶"></textarea>
            </div>
          </div>

          <!-- Sem√°foro Result (shown after submit) -->
          <div id="semaforoResult" class="hidden semaforo-result-box">
            <div class="glass semaforo-flex">
              <div class="traffic-light">
                <div class="tl-light" id="resRed"></div>
                <div class="tl-light" id="resYellow"></div>
                <div class="tl-light" id="resGreen"></div>
              </div>
              <div class="sem-info">
                <div class="sem-title" id="resTitle">Resultado del Sem√°foro</div>
                <div id="resBadge"></div>
                <div class="sem-detail" id="resMeta"></div>
                <div class="sem-detail" id="resConf"></div>
              </div>
            </div>
          </div>

          <!-- Submit buttons -->
          <div style="display:flex;justify-content:center;gap:12px;margin-top:20px;flex-wrap:wrap;">
            <button class="btn btn-primary btn-lg" id="btnSendNow">
              <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2">
                <path d="M22 2L11 13" />
                <polygon points="22 2 15 22 11 13 2 9 22 2" />
              </svg>
              Enviar ahora
            </button>
            <button class="btn btn-secondary btn-lg" id="btnSaveLocal">
              <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                <polyline points="17 21 17 13 7 13 7 21" />
                <polyline points="7 3 7 8 15 8" />
              </svg>
              Guardar local
            </button>
          </div>

          <!-- Sync bar -->
          <div class="glass"
            style="padding:14px 18px;margin:16px 0;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <button class="btn btn-secondary" id="btnSync">
              <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2">
                <polyline points="23 4 23 10 17 10" />
                <polyline points="1 20 1 14 7 14" />
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
              </svg>
              Sincronizar
            </button>
            <span class="muted">Pendientes: <b id="pendingCount">0</b></span>
            <span class="muted">√öltima sync: <span id="lastSync">‚Äî</span></span>
          </div>
          <div id="formMsg"></div>
        </div>

        <!-- ================================
           DASHBOARD
           ================================ -->
        <div id="panelDash" style="display:none;">
          <!-- Dashboard Sem√°foro Status -->
          <div class="glass semaforo-flex" style="margin-bottom:16px;">
            <div class="traffic-light">
              <div class="tl-light" id="lightRed"></div>
              <div class="tl-light" id="lightYellow"></div>
              <div class="tl-light" id="lightGreen"></div>
            </div>
            <div class="sem-info">
              <div class="sem-title" id="semTitle">Estado Actual del Sistema</div>
              <div id="semBadge"></div>
              <div class="sem-detail" id="semMeta"></div>
              <div class="sem-detail" id="semExplain"></div>
            </div>
          </div>

          <!-- Filters -->
          <div class="glass" style="padding:16px;margin-bottom:16px;">
            <div class="grid4">
              <div>
                <label>Ventana (d√≠as)</label>
                <select id="dashWindow">
                  <option value="7">7 d√≠as</option>
                  <option value="15">15 d√≠as</option>
                  <option value="30" selected>30 d√≠as</option>
                  <option value="60">60 d√≠as</option>
                  <option value="90">90 d√≠as</option>
                </select>
              </div>
              <div>
                <label>Tipo informante</label>
                <select id="dashTipo">
                  <option value="">(todos)</option>
                </select>
              </div>
              <div>
                <label>Comunidad</label>
                <select id="dashComunidad">
                  <option value="">(todas)</option>
                </select>
              </div>
              <div style="display:flex;align-items:flex-end;">
                <button class="btn btn-primary" id="btnDash" style="width:100%;">Actualizar tablero</button>
              </div>
            </div>
          </div>

          <!-- KPIs -->
          <div class="kpis" id="kpis"></div>

          <!-- Charts -->
          <div class="charts-grid" style="margin-top:16px;">
            <div class="glass chart-card">
              <h4>
                <svg viewBox="0 0 24 24">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                </svg>
                Evoluci√≥n Temporal
              </h4>
              <canvas id="chartTimeline" height="200"></canvas>
            </div>
            <div class="glass chart-card">
              <h4>
                <svg viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 2a10 10 0 0 1 10 10" />
                </svg>
                Distribuci√≥n Sem√°foro
              </h4>
              <canvas id="chartAlerts" height="200"></canvas>
            </div>
            <div class="glass chart-card" style="grid-column: span 2;">
              <h4>
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="20" x2="18" y2="10" />
                  <line x1="12" y1="20" x2="12" y2="4" />
                  <line x1="6" y1="20" x2="6" y2="14" />
                </svg>
                Temas M√°s Frecuentes
              </h4>
              <canvas id="chartDims" height="180"></canvas>
            </div>
          </div>

          <!-- Records Table -->
          <div class="glass" style="padding:18px;margin-top:16px;">
            <h4 style="margin:0 0 12px;font-size:14px;font-weight:700;display:flex;align-items:center;gap:8px;">
              <svg viewBox="0 0 24 24"
                style="width:18px;height:18px;fill:none;stroke:var(--emerald-600);stroke-width:2">
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              Registros Recientes
              <span class="muted">(<span id="tableCount">0</span> resultados)</span>
            </h4>
            <input type="text" id="dashSearch" placeholder="Buscar en registros‚Ä¶" style="margin-bottom:12px;">
            <div id="dashTable"></div>
          </div>

          <div id="dashMsg" style="margin-top:12px;"></div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="app-footer">
        ¬© 2025 PARACEL ‚Äì Sistema de Monitoreo de Clima Social y Alerta Temprana
      </footer>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./idb.js"></script>
  <script src="./app.js"></script>
</body>

</html>